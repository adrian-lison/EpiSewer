<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Modeling in EpiSewer ‚Ä¢ EpiSewer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Modeling in EpiSewer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiSewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/model-specification.html">Modeling in EpiSewer</a></li>
    <li><a class="dropdown-item" href="../articles/detailed-example.html">Detailed example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling details</h6></li>
    <li><a class="dropdown-item" href="../articles/model-definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/load_per_case.html">The "shedding load per case" assumption</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrian-lison/EpiSewer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Modeling in EpiSewer</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adrian-lison/EpiSewer/blob/main/vignettes/model-specification.Rmd" class="external-link"><code>vignettes/model-specification.Rmd</code></a></small>
      <div class="d-none name"><code>model-specification.Rmd</code></div>
    </div>

    
    
<p>This is a conceptual overview over the modeling functionality in
<code>EpiSewer</code>. See <code><a href="../articles/model-definition.html">vignette("model-definition")</a></code> for
a mathematical definition of the underlying generative model, and
<code><a href="../articles/detailed-example.html">vignette("detailed-example")</a></code> for an example vignette.</p>
<div class="section level2">
<h2 id="modules">Modules<a class="anchor" aria-label="anchor" href="#modules"></a>
</h2>
<p><code>EpiSewer</code> uses 5 different modules to describe the data
generating process behind the wastewater measurements:
<code>infections</code>, <code>shedding</code>, <code>sewage</code>,
<code>sampling</code>, and <code>measurements</code>. There is a 6th
module to specify <code>forecast</code> functionality. Each of these
modules consists of a number of module components, as shown below.</p>
<p><img src="figures%2Fspecification-model-1.png" alt="The 6 modules of the EpiSewer model" width="100%"></p>
<p>The modules are defined using their corresponding module function,
i.e.¬†by calling <code><a href="../reference/model_infections.html">model_infections()</a></code>,
<code><a href="../reference/model_shedding.html">model_shedding()</a></code>, <code><a href="../reference/model_sewage.html">model_sewage()</a></code>,
<code><a href="../reference/model_sampling.html">model_sampling()</a></code>, <code><a href="../reference/model_measurements.html">model_measurements()</a></code>, or
<code><a href="../reference/model_forecast.html">model_forecast()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="modeling-functions">Modeling functions<a class="anchor" aria-label="anchor" href="#modeling-functions"></a>
</h2>
<p>Components in a module can be specified using suitable modeling
functions. There are 5 types of modeling functions:</p>
<ul>
<li>
<code>_observe</code>: We provide observation data for this
component. For example, we can use <code><a href="../reference/concentrations_observe.html">concentrations_observe()</a></code>
if we have observed concentration measurements and want to fit the model
to them.</li>
<li>
<code>_assume</code>: We assume the values for this component. For
example, we can use <code><a href="../reference/generation_dist_assume.html">generation_dist_assume()</a></code> to provide a
generation time distribution from the literature.</li>
<li>
<code>_calibrate</code>: This is similar to <code>_assume</code>,
but instead of directly specifying the value for an assumption, we
calibrate it to some other assumption or data. For example, we can use
<code><a href="../reference/load_per_case_calibrate.html">load_per_case_calibrate()</a></code> to calibrate the shedding load
per case to case data (so that the estimated infections will roughly
match the observed case numbers).</li>
<li>
<code>_estimate</code>: We estimate this component as a parameter of
the model. For example, we can use <code><a href="../reference/noise_estimate.html">noise_estimate()</a></code> if we
don‚Äôt know how much noise the measurements have and want to estimate
this from the data.</li>
<li>
<code>_none</code>: We do not model this component. For example, we
can use <code><a href="../reference/sample_effects_none.html">sample_effects_none()</a></code> if we don‚Äôt want to model any
sample effects on the measurements.</li>
</ul>
<p>To find out which modeling functions are available for a given
component, you can consult the documentation or use the helper
<code><a href="../reference/component_functions.html">component_functions()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EpiSewer</span><span class="fu">::</span><span class="fu"><a href="../reference/component_functions.html">component_functions</a></span><span class="op">(</span><span class="st">"infection_noise"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "infection_noise_none()"     "infection_noise_estimate()"</span></span></code></pre></div>
<div class="section level4">
<h4 id="multiple-modeling-options">üí° Multiple modeling options<a class="anchor" aria-label="anchor" href="#multiple-modeling-options"></a>
</h4>
<p>Some components have multiple versions of the same modeling function
type. For example, there are currently three approaches to estimate the
reproduction number, namely <code><a href="../reference/R_estimate_splines.html">R_estimate_splines()</a></code> (smoothing
splines), <code><a href="../reference/R_estimate_rw.html">R_estimate_rw()</a></code> (random walk),
<code><a href="../reference/R_estimate_ets.html">R_estimate_ets()</a></code> (exponential smoothing), and
<code><a href="../reference/R_estimate_approx.html">R_estimate_approx()</a></code> (approximation of renewal model).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EpiSewer</span><span class="fu">::</span><span class="fu"><a href="../reference/component_functions.html">component_functions</a></span><span class="op">(</span><span class="st">"R"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "R_estimate_approx()"  "R_estimate_splines()" "R_estimate_rw()"     </span></span>
<span><span class="co">#&gt; [4] "R_estimate_ets()"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="modeling-restrictions">‚ùó Modeling restrictions<a class="anchor" aria-label="anchor" href="#modeling-restrictions"></a>
</h4>
<p>Not all components support all modeling types. For example,
<code>EpiSewer</code> currently only offers
<code><a href="../reference/generation_dist_assume.html">generation_dist_assume()</a></code>, but not
<code>generation_dist_estimate</code>,
<code>generation_dist_calibrate</code>, or
<code>generation_dist_observe</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">EpiSewer</span><span class="fu">::</span><span class="fu"><a href="../reference/component_functions.html">component_functions</a></span><span class="op">(</span><span class="st">"generation_dist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "generation_dist_assume()"</span></span></code></pre></div>
<p>This is because estimating the generation time distribution from data
is not yet supported (but may be added in the future).</p>
</div>
</div>
<div class="section level2">
<h2 id="data-and-assumptions">Data and assumptions<a class="anchor" aria-label="anchor" href="#data-and-assumptions"></a>
</h2>
<p>The <code><a href="../reference/sewer_data.html">sewer_data()</a></code> and <code><a href="../reference/sewer_assumptions.html">sewer_assumptions()</a></code>
functions are convenience functions that allow you to collect all
observation data and modeling assumptions in one place. This can improve
overview and allows to run <code>EpiSewer</code> under its default
settings without repeating the component definitions:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ww_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sewer_data.html">sewer_data</a></span><span class="op">(</span></span>
<span>  measurements <span class="op">=</span> <span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">measurements</span>,</span>
<span>  flows <span class="op">=</span> <span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">flows</span>,</span>
<span>  cases <span class="op">=</span> <span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">cases</span> <span class="co"># optional</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ww_assumptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sewer_assumptions.html">sewer_assumptions</a></span><span class="op">(</span></span>
<span>  generation_dist <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete_gamma_shifted.html">get_discrete_gamma_shifted</a></span><span class="op">(</span>gamma_mean <span class="op">=</span> <span class="fl">3</span>, gamma_sd <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span>,</span>
<span>  shedding_dist <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete_gamma.html">get_discrete_gamma</a></span><span class="op">(</span>gamma_shape <span class="op">=</span> <span class="fl">0.929639</span>, gamma_scale <span class="op">=</span> <span class="fl">7.241397</span><span class="op">)</span>,</span>
<span>  shedding_reference <span class="op">=</span> <span class="st">"symptom_onset"</span>,</span>
<span>  incubation_dist <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete_gamma.html">get_discrete_gamma</a></span><span class="op">(</span>gamma_shape <span class="op">=</span> <span class="fl">8.5</span>, gamma_scale <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/EpiSewer.html">EpiSewer</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">ww_data</span>,</span>
<span>  assumptions <span class="op">=</span> <span class="va">ww_assumptions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>What happens under the hood is that when individual model components
are not provided with the data or assumptions they need, they search the
data and assumption arguments passed to the <code><a href="../reference/EpiSewer.html">EpiSewer()</a></code>
function.</p>
<p>üí° It is always possible to mix both approaches and specify data or
assumptions explicitly in the model component:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Leave out flows from the data</span></span>
<span><span class="va">ww_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sewer_data.html">sewer_data</a></span><span class="op">(</span></span>
<span>  measurements <span class="op">=</span> <span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">measurements</span>,</span>
<span>  <span class="co">#flows = SARS_CoV_2_Zurich$flows</span></span>
<span>  cases <span class="op">=</span> <span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">cases</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Leave out the generation time distribution</span></span>
<span><span class="va">ww_assumptions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sewer_assumptions.html">sewer_assumptions</a></span><span class="op">(</span></span>
<span>  <span class="co">#generation_dist = get_discrete_gamma_shifted(gamma_mean = 3, gamma_sd = 2.4),</span></span>
<span>  shedding_dist <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete_gamma.html">get_discrete_gamma</a></span><span class="op">(</span>gamma_shape <span class="op">=</span> <span class="fl">0.929639</span>, gamma_scale <span class="op">=</span> <span class="fl">7.241397</span><span class="op">)</span>,</span>
<span>  shedding_reference <span class="op">=</span> <span class="st">"symptom_onset"</span>,</span>
<span>  incubation_dist <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete_gamma.html">get_discrete_gamma</a></span><span class="op">(</span>gamma_shape <span class="op">=</span> <span class="fl">8.5</span>, gamma_scale <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Provide flows directly to sewage module</span></span>
<span><span class="va">ww_sewage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_sewage.html">model_sewage</a></span><span class="op">(</span></span>
<span>  flows <span class="op">=</span> <span class="fu"><a href="../reference/flows_observe.html">flows_observe</a></span><span class="op">(</span><span class="va">SARS_CoV_2_Zurich</span><span class="op">$</span><span class="va">flows</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Provide generation time distribution directly to infections module</span></span>
<span><span class="va">ww_infections</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_infections.html">model_infections</a></span><span class="op">(</span></span>
<span>  generation_dist <span class="op">=</span> <span class="fu"><a href="../reference/generation_dist_assume.html">generation_dist_assume</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/get_discrete_gamma_shifted.html">get_discrete_gamma_shifted</a></span><span class="op">(</span>gamma_mean <span class="op">=</span> <span class="fl">3</span>, gamma_sd <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine everything</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EpiSewer.html">EpiSewer</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">ww_data</span>,</span>
<span>  assumptions <span class="op">=</span> <span class="va">ww_assumptions</span>,</span>
<span>  sewage <span class="op">=</span> <span class="va">ww_sewage</span>,</span>
<span>  infections <span class="op">=</span> <span class="va">ww_infections</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that if the same data or assumptions are supplied via the
<code><a href="../reference/sewer_data.html">sewer_data()</a></code>/<code><a href="../reference/sewer_assumptions.html">sewer_assumptions()</a></code> <em>and</em>
the individual component, <code><a href="../reference/EpiSewer.html">EpiSewer()</a></code> will compare both
arguments and throw an error if they differ.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian Lison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
