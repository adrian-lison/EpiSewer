<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model definition • EpiSewer</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Model definition">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiSewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/model-specification.html">Modeling in EpiSewer</a></li>
    <li><a class="dropdown-item" href="../articles/detailed-example.html">Detailed example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling details</h6></li>
    <li><a class="dropdown-item" href="../articles/model-definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/load_per_case.html">The "shedding load per case" assumption</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrian-lison/EpiSewer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Model definition</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adrian-lison/EpiSewer/blob/v0.0.4/vignettes/model-definition.Rmd" class="external-link"><code>vignettes/model-definition.Rmd</code></a></small>
      <div class="d-none name"><code>model-definition.Rmd</code></div>
    </div>

    
    
<p>Modeling by Adrian Lison<br><em>ETH Zurich, Department of Biosystems
Science and Engineering, Zurich, Switzerland</em></p>
<p>This document details the generative model used by
<code>EpiSewer</code> to estimate reproduction numbers from wastewater
concentration measurements. The model is structured into 5 modules,
namely <a href="#infections-module">infections</a>, <a href="#shedding-module">shedding</a>, <a href="#sewage-module">sewage</a>, <a href="#sampling-module">sampling</a>, and <a href="#measurements-module">measurements</a>.</p>
<p>Note that below, the full model with all options is specified, while
<code>EpiSewer</code> excludes certain parts of the model by default
(e.g. no multi-day composite samples) - these have to be explicitly
selected by the user to be included.</p>
<div class="section level2">
<h2 id="infections-module">Infections module<a class="anchor" aria-label="anchor" href="#infections-module"></a>
</h2>
<div class="section level3">
<h3 id="reproduction-number">Reproduction number<a class="anchor" aria-label="anchor" href="#reproduction-number"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math></p>
<div class="section level4">
<h4 id="link-function">Link function<a class="anchor" aria-label="anchor" href="#link-function"></a>
</h4>
<p>The model employs a link function to ensure that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R_t&gt;0</annotation></semantics></math>
regardless of the smoothing approach used. An obvious choice for this is
the log link, which however has the disadvantage that it implies an
asymmetric prior on changes in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
(for example, a change from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">R_t=2</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t=1</annotation></semantics></math>
would be much more likely than a change from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t=1</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">R_t=2</annotation></semantics></math>).
<code>EpiSewer</code> therefore provides alternative link functions
which are configured to behave approximately like the identity function
around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t=1</annotation></semantics></math>
but ensure that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R_t&gt;0</annotation></semantics></math>.</p>
<div class="section level5">
<h5 id="option-1-inverse-softplus">Option 1: Inverse softplus<a class="anchor" aria-label="anchor" href="#option-1-inverse-softplus"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mtext mathvariant="normal">link</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mtext mathvariant="normal">softplus</mtext><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mi>k</mi><mi>x</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mi>k</mi></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}^{-1}(x) = \text{softplus}_k(x) = \frac{\log(1+e^{kx})}{k}
\end{equation}</annotation></semantics></math></p>
<p>with sharpness parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</p>
<p>By default, we choose
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k=4</annotation></semantics></math>,
which makes the softplus function behave effectively like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">f(x)=x</annotation></semantics></math>
for practically relevant values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
while ensuring that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">R_t&gt;0</annotation></semantics></math>.</p>
</div>
<div class="section level5">
<h5 id="option-2-scaled-logit">Option 2: Scaled logit<a class="anchor" aria-label="anchor" href="#option-2-scaled-logit"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mtext mathvariant="normal">link</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mtext mathvariant="normal">logistic</mtext><mrow><mi>c</mi><mo>,</mo><mi>a</mi><mo>,</mo><mi>k</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mi>c</mi><mrow><mn>1</mn><mo>+</mo><mi>a</mi><mspace width="0.167em"></mspace><msup><mi>e</mi><mrow><mo>−</mo><mi>k</mi><mspace width="0.167em"></mspace><mi>x</mi></mrow></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}^{-1}(x) = \text{logistic}_{c, a, k}(x) = \frac{c}{1 + a \, e^{-k \, x}}
\end{equation}</annotation></semantics></math></p>
<p>with hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>.</p>
<p>Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
defines the maximum possible
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
(default
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mo>max</mo></msub><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">R_\max=6</annotation></semantics></math>).
This link function is inspired from the epidemia package<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Scott, J. A. &lt;em&gt;et al.&lt;/em&gt; epidemia: Modeling of
epidemics using hierarchical bayesian models. (2020). Available from: &lt;a href="https://imperialcollegelondon.github.io/epidemia/index.html" class="external-link uri"&gt;https://imperialcollegelondon.github.io/epidemia/index.html&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>, but has two further
hyperparameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>,
which are chosen such that the logistic function equals 1 at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">x=1</annotation></semantics></math>
and also has a derivative of 1. Thus, the link function behaves roughly
like the identity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">f(x)=x</annotation></semantics></math>
around
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_t=1</annotation></semantics></math>,
which makes the definition of adequate smoothing priors for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
easier.</p>
</div>
</div>
<div class="section level4">
<h4 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h4>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
is modeled via a time series or smoothing spline prior which ensure
smoothness through temporal autocorrelation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
estimates.</p>
<div class="section level5">
<h5 id="option-1-gaussian-process-default">Option 1: Gaussian process (default)<a class="anchor" aria-label="anchor" href="#option-1-gaussian-process-default"></a>
</h5>
<p>This option models
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
using Gaussian processes (GPs) with a Matérn kernel, i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>α</mi><mi>t</mi></msub><mo>+</mo><msub><mi>δ</mi><mi>t</mi></msub><mspace width="1.0em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="1.0em"></mspace><mi>α</mi><mo>∼</mo><mrow><mi>𝒢</mi><mi>𝒫</mi></mrow><mspace width="0.167em"></mspace><mspace width="-0.167em"></mspace><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mn>1</mn><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>k</mi><mi>ν</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>;</mo><mspace width="0.167em"></mspace><msub><mo>ℓ</mo><mi>α</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>α</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo><mo>,</mo><mspace width="0.278em"></mspace><mi>δ</mi><mo>∼</mo><mrow><mi>𝒢</mi><mi>𝒫</mi></mrow><mspace width="0.167em"></mspace><mspace width="-0.167em"></mspace><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">(</mo><mn>0</mn><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>k</mi><mi>ν</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>τ</mi><mo>;</mo><mspace width="0.167em"></mspace><msub><mo>ℓ</mo><mi>δ</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>δ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">)</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}(R_t) = \alpha_t + \delta_t\quad |\quad \alpha \sim \mathcal{GP}\,\!\big(1,\, k_\nu(\tau;\,\ell_\alpha,\sigma^2_\alpha)\big),\; \delta \sim \mathcal{GP}\,\!\big(0,\, k_\nu(\tau;\,\ell_\delta,\sigma^2_\delta)\big),
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>α</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\alpha_t</annotation></semantics></math>
is the long-term trend,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\delta_t</annotation></semantics></math>
is the short-term deviation from the trend, modeled each as independent
Gaussian processes with Matérn kernel
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mi>ν</mi></msub><annotation encoding="application/x-tex">k_\nu</annotation></semantics></math>
and smoothness parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ν</mi><mo>=</mo><mfrac><mn>3</mn><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\nu=\frac{3}{2}</annotation></semantics></math>.
Importantly, we choose priors for the kernel parameters such that the
length scale
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mo>ℓ</mo><mi>α</mi></msub><annotation encoding="application/x-tex">\ell_\alpha</annotation></semantics></math>
and magnitude
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>α</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
of the long-term trend are in expectation much larger than those of the
short-term deviation,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mo>ℓ</mo><mi>δ</mi></msub><annotation encoding="application/x-tex">\ell_\delta</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>δ</mi></msub><annotation encoding="application/x-tex">\sigma_\delta</annotation></semantics></math>.
By decomposing Rt into long- and short-term components, we obtain
desirable behavior in real-time estimation: absent a clear signal, the
short-term deviation component will revert to zero, such that Rt will
follow the long-term trend.</p>
</div>
<div class="section level5">
<h5 id="option-2-random-walk">Option 2: Random walk<a class="anchor" aria-label="anchor" href="#option-2-random-walk"></a>
</h5>
<p>This option smoothes Rt using a simple random walk model, i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><msub><mi>R</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msup><msub><mi>σ</mi><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}(R_t)\,|\,R_{t-1} \sim N(\text{link}(R_{t-1}),{\sigma_{\text{link}(R)}}^2)
\end{equation}</annotation></semantics></math></p>
<p>with a normal prior on the intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>1</mn></msub><annotation encoding="application/x-tex">R_1</annotation></semantics></math>
and a zero-truncated normal prior on the standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><annotation encoding="application/x-tex">\sigma_{\text{link}(R)}</annotation></semantics></math>
of the random walk.</p>
</div>
<div class="section level5">
<h5 id="option-3-exponential-smoothing">Option 3: Exponential smoothing<a class="anchor" aria-label="anchor" href="#option-3-exponential-smoothing"></a>
</h5>
<p>This option uses an <strong>innovations state space model</strong>
with additive errors to implement an exponential smoothing prior (Holt’s
linear trend method with damping)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Hyndman, R. J. &amp;amp; Athanasopoulos, G. &lt;em&gt;Forecasting:
principles and practice&lt;/em&gt;. (OTexts, 2018).&lt;/p&gt;"><sup>2</sup></a>. For this,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
is modeled recursively as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>l</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>ϕ</mi><mi>′</mi><mspace width="0.167em"></mspace><msub><mi>b</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>ϵ</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>l</mi><mi>t</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>l</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>ϕ</mi><mi>′</mi><mspace width="0.167em"></mspace><msub><mi>b</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>α</mi><mi>′</mi><mspace width="0.167em"></mspace><msub><mi>ϵ</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>b</mi><mi>t</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>ϕ</mi><mi>′</mi><mspace width="0.167em"></mspace><msub><mi>b</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><mi>β</mi><mi>′</mi><mspace width="0.167em"></mspace><msub><mi>ϵ</mi><mi>t</mi></msub></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>ϵ</mi><mi>t</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msup><msub><mi>σ</mi><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
    \text{link}(R_t) &amp;= l_{t-1} + \phi' \, b_{t-1} + \epsilon_t \\
    l_t &amp;= l_{t-1} + \phi' \, b_{t-1} + \alpha' \, \epsilon_t \\
    b_t &amp;= \phi' \, b_{t-1} + \beta' \, \epsilon_t \\
    \epsilon_t &amp;\sim N(0,{\sigma_{\text{link}(R)}}^2),
\end{align*}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>l</mi><mi>t</mi></msub><annotation encoding="application/x-tex">l_t</annotation></semantics></math>
is the level,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mi>t</mi></msub><annotation encoding="application/x-tex">b_t</annotation></semantics></math>
the trend, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\epsilon_t</annotation></semantics></math>
the additive error at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
respectively.</p>
<p>Moreover,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\alpha'</annotation></semantics></math>
is a level smoothing parameter,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\beta'</annotation></semantics></math>
a trend smoothing parameter, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\phi'</annotation></semantics></math>
a damping parameter. We use normal priors for the intercepts of the
level
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>l</mi><mn>1</mn></msub><annotation encoding="application/x-tex">l_1</annotation></semantics></math>
and trend
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>b</mi><mn>1</mn></msub><annotation encoding="application/x-tex">b_1</annotation></semantics></math>,
and a zero-truncated normal prior for the variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><msub><mi>σ</mi><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mn>2</mn></msup><annotation encoding="application/x-tex">{\sigma_{\text{link}(R)}}^2</annotation></semantics></math>
of the innovations, allowing these to be estimated from the data. We use
Beta priors for the smoothing parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\alpha'</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\beta'</annotation></semantics></math>.</p>
<p>In theory, the damping parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">\phi'</annotation></semantics></math>
can also be estimated from the data, but usually has to be fixed due to
identifiability issues. The default is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mi>′</mi><mo>=</mo><mn>0.9</mn></mrow><annotation encoding="application/x-tex">\phi'=0.9</annotation></semantics></math>,
i.e. the strength of the trend is assumed to halve approximately every
week of predicting into the future.</p>
</div>
<div class="section level5">
<h5 id="option-4-splines">Option 4: Splines<a class="anchor" aria-label="anchor" href="#option-4-splines"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>𝐁</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>t</mi><mo>,</mo><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></msub><mspace width="0.167em"></mspace><mi>a</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}(R_t) = \boldsymbol{B}_{[t,\,]} \, a
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐁</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>t</mi><mo>,</mo><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{B}_{[t,\,]}</annotation></semantics></math>
is a (by default cubic) B-spline basis evaluated at date index
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><msub><mi>a</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi><mtext mathvariant="normal">df</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a = (a_1, a_2, \dots, a_\text{df})</annotation></semantics></math>
is a vector of spline coefficients, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">df</mtext><mo>=</mo><mtext mathvariant="normal">number of knots</mtext><mo>+</mo><mtext mathvariant="normal">spline degree</mtext></mrow><annotation encoding="application/x-tex">\text{df} = \text{number of knots} + \text{spline degree}</annotation></semantics></math>
being the degrees of freedom.</p>
<p>We here use <em>penalized</em> B-splines, implemented by regularizing
the spline coefficients via a random walk<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Kharratzadeh, M. &amp;amp; Stan development team. Splines in
Stan. Stan documentation case study. (2017). Available from: &lt;a href="https://mc-stan.org" class="external-link uri"&gt;https://mc-stan.org&lt;/a&gt;.&lt;/p&gt;'><sup>3</sup></a>, i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><msub><mi>a</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>,</mo><msubsup><mi>σ</mi><mi>a</mi><mn>2</mn></msubsup><mspace width="0.167em"></mspace><msub><mi>δ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
a_{i}\,|\,a_{i-1} \sim N(a_{i-1}, \sigma_{a}^2 \, \delta_i)
\end{equation}</annotation></semantics></math></p>
<p>where the random walk variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>a</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{a}^2</annotation></semantics></math>
is scaled by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>δ</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\delta_i</annotation></semantics></math>,
the distance between knot
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and knot
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math>.
This allows to provide a (zero-truncated normal) prior on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>a</mi></msub><annotation encoding="application/x-tex">\sigma_{a}</annotation></semantics></math>
which is independent of the distance between knots. By enforcing
smoothness of the spline coefficients, the risk of overfitting the
splines is greatly reduced. For the intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mn>1</mn></msub><annotation encoding="application/x-tex">a_1</annotation></semantics></math>,
a normal prior reflecting the expectation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
at the beginning of the time series is used.</p>
<p>Knots are placed uniformly according to a user-specified knot
distance, however the knot distance is heuristically reduced for dates
close to the present (which are only partially informed by data) to
avoid erroneous extrapolation.</p>
<p>EpiSewer also supports multi-level spline smoothing by decomposing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>t</mi></msub><mo>=</mo><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo>+</mo><msubsup><mi>δ</mi><mi>t</mi><mtext mathvariant="normal">local</mtext></msubsup><mo>+</mo><msubsup><mi>δ</mi><mi>t</mi><mtext mathvariant="normal">global</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
R_t = \text{link}(R_1 + \delta_t^\text{local} + \delta_t^\text{global}), 
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>1</mn></msub><annotation encoding="application/x-tex">R_1</annotation></semantics></math>
is an intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>δ</mi><mi>t</mi><mtext mathvariant="normal">local</mtext></msubsup><annotation encoding="application/x-tex">\delta_t^\text{local}</annotation></semantics></math>
a component for smaller, short-term variation, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>δ</mi><mi>t</mi><mtext mathvariant="normal">global</mtext></msubsup><annotation encoding="application/x-tex">\delta_t^\text{global}</annotation></semantics></math>
a component for larger, long-term variation. The two components are then
smoothed using penalized cubic splines as described above, i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>δ</mi><mi>t</mi><mi>ϕ</mi></msubsup><mo>=</mo><msubsup><mi>𝐁</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>t</mi><mo>,</mo><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow><mi>ϕ</mi></msubsup><mspace width="0.167em"></mspace><msup><mi>a</mi><mi>ϕ</mi></msup><mo>,</mo><mspace width="1.0em"></mspace><mi>ϕ</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mtext mathvariant="normal">local</mtext><mo>,</mo><mtext mathvariant="normal">global</mtext><mo stretchy="false" form="postfix">}</mo><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\delta_t^\phi = \boldsymbol{B}^\phi_{[t,\,]} \, a^\phi, \quad \phi \in \{\text{local},\text{global}\}.
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="option-5-smooth-derivative">Option 5: Smooth derivative<a class="anchor" aria-label="anchor" href="#option-5-smooth-derivative"></a>
</h5>
<p>This option enforces a smooth first derivative of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
by placing cubic splines on the first-order differences of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>,
</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>δ</mi><mi>t</mi></msub><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>δ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>𝐁</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>t</mi><mo>,</mo><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">]</mo></mrow></msub><mspace width="0.167em"></mspace><mi>a</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}(R_t) = \text{link}(R_{t-1}) + \delta_t,\quad \delta_t = \boldsymbol{B}_{[t,\,]} \, a,
\end{equation}</annotation></semantics></math></p>
<p>where the spline coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mn>0</mn></msub><mo>,</mo><msub><mi>a</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>a</mi><mrow><mi>n</mi><mo>+</mo><mn>2</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a = (a_0, a_1, \dots, a_{n+2})</annotation></semantics></math>
are given a sparse Normal-Exponential-Gamma prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>∼</mo><mtext mathvariant="normal">NEG</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>λ</mi><mo>=</mo><msub><mi>λ</mi><mi>a</mi></msub><mo>,</mo><mi>γ</mi><mo>=</mo><msub><mi>γ</mi><mi>a</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a_i \sim \text{NEG}(\mu = 0, \lambda = \lambda_a, \gamma = \gamma_a)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 \leq i \leq n+1</annotation></semantics></math>.
This prior has a long tail that supports large changes in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.
The first and last spline coefficient are fixed to 0 to avoid erroneous
extrapolation towards the boundaries. This also has the effect that
trends in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
level off towards the present.</p>
</div>
<div class="section level5">
<h5 id="option-6-piecewise-constant">Option 6: Piecewise constant<a class="anchor" aria-label="anchor" href="#option-6-piecewise-constant"></a>
</h5>
<p>This option models
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
as a piecewise constant function. The changepoints of the constant
pieces are estimated from the data using an approximate changepoint
model, corresponding roughly to the following model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mn>1</mn></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>a</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><mn>𝟙</mn><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>≥</mo><msub><mi>C</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\text{link}(R_t) = \text{link}(R_1 + \sum_{i=1}^K a_i \, \mathbb{1}(t \geq C_i))
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>1</mn></msub><annotation encoding="application/x-tex">R_1</annotation></semantics></math>
is the intercept,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mi>i</mi></msub><annotation encoding="application/x-tex">C_i</annotation></semantics></math>
are the estimated changepoint times of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
different changepoints, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mi>i</mi></msub><annotation encoding="application/x-tex">a_i</annotation></semantics></math>
is the change in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
at changepoint
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>,
modeled via a sparse Normal-Exponential-Gamma prior
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>∼</mo><mtext mathvariant="normal">NEG</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>=</mo><mn>0</mn><mo>,</mo><mi>λ</mi><mo>=</mo><msub><mi>λ</mi><mi>a</mi></msub><mo>,</mo><mi>γ</mi><mo>=</mo><msub><mi>γ</mi><mi>a</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">a_i \sim \text{NEG}(\mu = 0, \lambda = \lambda_a, \gamma = \gamma_a)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">1 \leq i \leq K</annotation></semantics></math>.
This prior has a long tail that supports large changes in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.
Generally, this option is suitable when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
follows a step-like trajectory with occasional large jumps, e.g. due to
strong interventions. It is less suitable for modeling gradual changes
in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
over time.</p>
</div>
<div class="section level5">
<h5 id="addition-changepoint-model-for-variability">Addition: Changepoint model for variability<a class="anchor" aria-label="anchor" href="#addition-changepoint-model-for-variability"></a>
</h5>
<p>Options 2-4 also support changes in the variability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
over time. For example, during the height of an epidemic wave,
countermeasures may lead to much faster changes in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
than observable at other times (baseline). This potential additional
variability is modeled using a linear change point model for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mrow><mtext mathvariant="normal">link</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{\text{link}(R)}^2</annotation></semantics></math>
(or for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>a</mi></msub><annotation encoding="application/x-tex">\sigma_{a}</annotation></semantics></math>
when using splines). The change points are placed at regular intervals,
and the additional variation at the changepoints is modeled as
independently distributed and following an Exponential-Gamma (EG)
distribution, which has a strong peak towards zero and a long tail.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="infections">Infections<a class="anchor" aria-label="anchor" href="#infections"></a>
</h3>
<p><code>EpiSewer</code> uses a stochastic renewal model as described in
earlier work<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Bhatt, S. &lt;em&gt;et al.&lt;/em&gt; Semi-Mechanistic Bayesian
Modeling of COVID-19 with Renewal Processes. &lt;em&gt;arXiv:2012.00394&lt;/em&gt;
(2020).&lt;/p&gt;"><sup>4</sup></a><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Lison, A., Abbott, S., Huisman, J. &amp;amp; Stadler, T.
Generative Bayesian modeling to nowcast the effective reproduction
number from line list data with missing symptom onset dates. Preprint at
&lt;a href="https://doi.org/10.48550/arXiv.2308.13262" class="external-link"&gt;https://doi.org/10.48550/arXiv.2308.13262&lt;/a&gt;
(2023).&lt;/p&gt;'><sup>5</sup></a> to model both expected and realized
infections.</p>
<div class="section level4">
<h4 id="expected-infections">Expected infections<a class="anchor" aria-label="anchor" href="#expected-infections"></a>
</h4>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ι</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\iota_t</annotation></semantics></math></p>
<p>We model the expected number of infections
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ι</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\iota_t</annotation></semantics></math>
via the renewal equation</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ι</mi><mi>t</mi></msub><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>I</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mi>R</mi><mi>t</mi></msub><munderover><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></munderover><msubsup><mi>τ</mi><mi>s</mi><mtext mathvariant="normal">gen</mtext></msubsup><mspace width="0.167em"></mspace><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><mi>t</mi><mo>&gt;</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\iota_t = E[I_t] = R_t \sum_{s=1}^G \tau^\text{gen}_s \, I_{t-s} \,|\, t &gt; G
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">I_{t-s}</annotation></semantics></math>
is the number of realized infections that occurred
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>
days before
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mtext mathvariant="normal">gen</mtext></msup><annotation encoding="application/x-tex">\tau^\text{gen}</annotation></semantics></math>
is a discrete generation time distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>τ</mi><mtext mathvariant="normal">gen</mtext></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>τ</mi><mn>1</mn><mtext mathvariant="normal">gen</mtext></msubsup><mo>,</mo><msubsup><mi>τ</mi><mn>2</mn><mtext mathvariant="normal">gen</mtext></msubsup><mo>,</mo><mi>…</mi><mo>,</mo><msubsup><mi>τ</mi><mi>G</mi><mtext mathvariant="normal">gen</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tau^\text{gen} = (\tau^\text{gen}_1, \tau^\text{gen}_2, \dots, \tau^\text{gen}_G)</annotation></semantics></math>
with maximum generation time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="realized-infections">Realized infections<a class="anchor" aria-label="anchor" href="#realized-infections"></a>
</h4>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>t</mi></msub><annotation encoding="application/x-tex">I_t</annotation></semantics></math></p>
<div class="section level5">
<h5 id="option-1-poisson">Option 1: Poisson<a class="anchor" aria-label="anchor" href="#option-1-poisson"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>∼</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
I_t|\iota_t \sim \text{Poisson}(\iota_t)
\end{equation}</annotation></semantics></math></p>
<p>with expected infections
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ι</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\iota_t</annotation></semantics></math>.</p>
<p>In the stan implementation, this is approximated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>,</mo><msub><mi>ι</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_t|\iota_t \sim N\left(\iota_t, \iota_t\right)</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="option-2-negative-binomial">Option 2: Negative binomial<a class="anchor" aria-label="anchor" href="#option-2-negative-binomial"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>∼</mo><mtext mathvariant="normal">Negative binomial</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>=</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo>=</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>+</mo><mfrac><msubsup><mi>ι</mi><mi>t</mi><mn>2</mn></msubsup><mi>ϕ</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
I_t|\iota_t \sim \text{Negative binomial}(\mu = \iota_t, \sigma^2 = \iota_t + \frac{\iota_t^2}{\phi})
\end{equation}</annotation></semantics></math></p>
<p>with expected infections
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ι</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\iota_t</annotation></semantics></math>
and inverse overdispersion parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
. Following <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Stan development team. Prior Choice Recommendations.
(2020). Available from: &lt;a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations" class="external-link uri"&gt;https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations&lt;/a&gt;.&lt;/p&gt;'><sup>6</sup></a>, we place a zero-truncated normal prior not
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
but on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mo>=</mo><mfrac><mn>1</mn><msqrt><mi>ϕ</mi></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\xi = \frac{1}{\sqrt{\phi}}</annotation></semantics></math>.</p>
<p>In the stan implementation, this is approximated as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>,</mo><msub><mi>ι</mi><mi>t</mi></msub><mo>+</mo><mfrac><msubsup><mi>ι</mi><mi>t</mi><mn>2</mn></msubsup><mi>ϕ</mi></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_t|\iota_t \sim N\left(\iota_t, \iota_t + \frac{\iota_t^2}{\phi}\right)</annotation></semantics></math></p>
</div>
</div>
<div class="section level4">
<h4 id="seeding">Seeding<a class="anchor" aria-label="anchor" href="#seeding"></a>
</h4>
<p>We require a seeding phase at the start of the modeled time period,
which describes the time evolution of infections when the renewal model
cannot be applied yet.</p>
<div class="section level5">
<h5 id="option-1-constant">Option 1: Constant<a class="anchor" aria-label="anchor" href="#option-1-constant"></a>
</h5>
<p>This option assumes a constant number of expected infections
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ι</mi><mrow><mi>s</mi><mi>e</mi><mi>e</mi><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">\iota_{seed}</annotation></semantics></math>
during the seeding phase, which is modeled via a normal prior on the log
scale:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mrow><mi>s</mi><mi>e</mi><mi>e</mi><mi>d</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><mi>t</mi><mo>≤</mo><mi>G</mi><mo>,</mo><mspace width="1.0em"></mspace><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mtext mathvariant="normal">seed</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mtext mathvariant="normal">seed</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mo>,</mo><msubsup><mi>σ</mi><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mtext mathvariant="normal">seed</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\log(\iota_t) = \log(\iota_{seed}) \,|\, t \leq G,\quad \log(\iota_\text{seed}) \sim N(\mu_{\log(\iota_\text{seed})},\sigma_{\log(\iota_\text{seed})}^2)
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="option-2-random-walk-1">Option 2: Random walk<a class="anchor" aria-label="anchor" href="#option-2-random-walk-1"></a>
</h5>
<p>This option models the expected number of infections during the
seeding phase via random walk on the log scale:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>ι</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msup><msub><mi>σ</mi><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ι</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mo stretchy="true" form="postfix">|</mo></mrow><mspace width="0.167em"></mspace><mi>t</mi><mo>≤</mo><mi>G</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\log(\iota_t)|\iota_{t-1} \sim N(\log(\iota_{t-1}),{\sigma_{\log(\iota)}}^2) \,|\, t \leq G
\end{equation}</annotation></semantics></math></p>
<p>with a normal prior on intercept
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(\iota_1)</annotation></semantics></math>
and a zero-truncated normal prior on the standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ι</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><annotation encoding="application/x-tex">\sigma_{\log(\iota)}</annotation></semantics></math>
of the random walk.</p>
</div>
<div class="section level5">
<h5 id="option-3-growth-rate-model">Option 3: Growth rate model<a class="anchor" aria-label="anchor" href="#option-3-growth-rate-model"></a>
</h5>
<p>This option models the expected number of infections during the
seeding phase as an exponential growth process:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ι</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>r</mi><mi>t</mi></msub><mo>,</mo><mspace width="0.278em"></mspace><mspace width="0.222em"></mspace><msub><mi>r</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">|</mo><msub><mi>r</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>r</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>,</mo><msup><msub><mi>σ</mi><mi>r</mi></msub><mn>2</mn></msup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.278em"></mspace><mspace width="0.278em"></mspace><mo stretchy="true" form="postfix">|</mo></mrow><mspace width="0.278em"></mspace><mn>1</mn><mo>&lt;</mo><mi>t</mi><mo>≤</mo><mi>G</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\log(\iota_t) = \log(\iota_{t-1}) + r_{t},\;\ r_{t} | r_{t+1} \sim N(r_{t+1},{\sigma_{r}}^2) \; \;|\; 1 &lt; t \leq G,
\end{equation}</annotation></semantics></math></p>
<p>Here the exponential growth rate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mi>t</mi></msub><annotation encoding="application/x-tex">r_t</annotation></semantics></math>
follows a backwards-in-time random walk with standard deviation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>r</mi></msub><annotation encoding="application/x-tex">\sigma_{r}</annotation></semantics></math>
and initial value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>G</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">r_{G+1}</annotation></semantics></math>.
The value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>r</mi><mrow><mi>G</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">r_{G+1}</annotation></semantics></math>
corresponds to the last growth rate of the seeding phase, which we set
to the first estimated reproduction number
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
at the start of the modeling phase. We achieve this using an approach
from the EpiAware package<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Brand S &amp;amp; Abbott S, EpiAware.jl: Infectious disease
situational awareness modelling toolkit for julia. &lt;a href="https://github.com/CDCgov/Rt-without-renewal" class="external-link"&gt;https://github.com/CDCgov/Rt-without-renewal&lt;/a&gt;.&lt;/p&gt;'><sup>7</sup></a>, i.e. by solving the renewal equation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>G</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>1</mn></mrow><mi>G</mi></msubsup><msubsup><mi>τ</mi><mi>s</mi><mtext mathvariant="normal">gen</mtext></msubsup><msup><mi>e</mi><mrow><mo>−</mo><mi>s</mi><mspace width="0.167em"></mspace><msub><mi>r</mi><mrow><mi>G</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">R_{G+1} (\sum_{s=1}^G \tau^\text{gen}_s e^{-s\,r_{G+1}}) = 1</annotation></semantics></math>
within the model. This means that the intercept of the seeding phase
growth rate depends on the prior provided for the initial reproduction
number.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="shedding-module">Shedding module<a class="anchor" aria-label="anchor" href="#shedding-module"></a>
</h2>
<div class="section level3">
<h3 id="expected-symptom-onsets">Expected symptom onsets<a class="anchor" aria-label="anchor" href="#expected-symptom-onsets"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\lambda_t</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>0</mn></mrow><mi>L</mi></munderover><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub><mspace width="0.167em"></mspace><msubsup><mi>τ</mi><mi>s</mi><mtext mathvariant="normal">inc</mtext></msubsup></mrow><annotation encoding="application/x-tex">\begin{equation}
\lambda_t = \sum_{s=0}^L I_{t-s}\, \tau^\text{inc}_s
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>τ</mi><mtext mathvariant="normal">inc</mtext></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>τ</mi><mn>0</mn><mtext mathvariant="normal">inc</mtext></msubsup><mo>,</mo><msubsup><mi>τ</mi><mn>1</mn><mtext mathvariant="normal">inc</mtext></msubsup><mo>,</mo><mi>…</mi><mo>,</mo><msubsup><mi>τ</mi><mi>L</mi><mtext mathvariant="normal">inc</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tau^\text{inc} = (\tau^\text{inc}_0, \tau^\text{inc}_1, \dots, \tau^\text{inc}_L)</annotation></semantics></math>
is the incubation period distribution with maximum incubation period
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>.
Note that this model component is only relevant when the shedding load
distribution is referenced by the date of symptom onset. When the
shedding load distribution is referenced by the date of infection, this
component can be subsumed in the shedding load model.</p>
</div>
<div class="section level3">
<h3 id="shedding-load-distribution">Shedding load distribution<a class="anchor" aria-label="anchor" href="#shedding-load-distribution"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\tau^\text{shed}</annotation></semantics></math></p>
<p>The vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>τ</mi><mtext mathvariant="normal">shed</mtext></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>τ</mi><mn>0</mn><mtext mathvariant="normal">shed</mtext></msubsup><mo>,</mo><msubsup><mi>τ</mi><mn>1</mn><mtext mathvariant="normal">shed</mtext></msubsup><mo>,</mo><mi>…</mi><mo>,</mo><msubsup><mi>τ</mi><mi>S</mi><mtext mathvariant="normal">shed</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tau^\text{shed} = (\tau^\text{shed}_0, \tau^\text{shed}_1, \dots, \tau^\text{shed}_S)</annotation></semantics></math>
represents the distribution of shedding over time, with shedding up to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>S</mi><annotation encoding="application/x-tex">S</annotation></semantics></math>
days after infection or after symptom onset (depending on the model
specification). It can be either assumed (fixed) or estimated (requires
a prior). When estimating the shedding load distribution, priors are
placed on the mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>μ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\mu^\text{shed}</annotation></semantics></math>
and coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ν</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\nu^\text{shed}</annotation></semantics></math>
of a positive continuous distribution (gamma or log-normal), which is
transformed into a discrete distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\tau^\text{shed}</annotation></semantics></math>
within the model. This approach is inspired by the modeling of
epidemiological distributions in the EpiNow2<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Abbott S, et al., Estimating the time-varying
reproduction number of SARS-CoV-2 using national and subnational case
counts. Wellcome Open Res. 5, 112 (2020). Package: &lt;a href="https://github.com/epiforecasts/EpiNow2" class="external-link"&gt;https://github.com/epiforecasts/EpiNow2&lt;/a&gt;.&lt;/p&gt;'><sup>8</sup></a> and epinowcast<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Abbott S, Lison A, et al., Epinowcast: Flexible
hierarchical nowcasting. &lt;a href="https://github.com/epinowcast/epinowcast" class="external-link"&gt;https://github.com/epinowcast/epinowcast&lt;/a&gt;.&lt;/p&gt;'><sup>9</sup></a>
packages.</p>
<p>EpiSewer also supports modeling the shedding load distribution from
multiple priors in order to account for estimates from different studies
or sensitivity analyses. Using a set of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
prior pairs, we model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>μ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\mu^\text{shed}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ν</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\nu^\text{shed}</annotation></semantics></math>
as the weighted mean of prior parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>μ</mi><mtext mathvariant="normal">shed</mtext></msup><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>𝛉</mi><mi>𝐢</mi></msub><mspace width="0.167em"></mspace><msubsup><mi>μ</mi><mi>i</mi><mtext mathvariant="normal">shed</mtext></msubsup></mrow><annotation encoding="application/x-tex">\mu^\text{shed} = \sum_{i=1}^{n} \boldsymbol{\theta_i}\, \mu^\text{shed}_i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>ν</mi><mtext mathvariant="normal">shed</mtext></msup><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>𝛉</mi><mi>𝐢</mi></msub><mspace width="0.167em"></mspace><msubsup><mi>ν</mi><mi>i</mi><mtext mathvariant="normal">shed</mtext></msubsup></mrow><annotation encoding="application/x-tex">\nu^\text{shed} = \sum_{i=1}^{n} \boldsymbol{\theta_i}\, \nu^\text{shed}_i</annotation></semantics></math>,
with the weights
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>
drawn from a Dirichlet distribution. By default, we use a symmetric
Dirichlet prior with concentration parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a = 1</annotation></semantics></math>,
corresponding to a uniform distribution over the weight simplex (i.e. we
interpolate between the provided priors). By choosing a smaller
concentration parameter, a more isolated support of the individual
priors provided can be achieved. It is also possible to apply
differential weighting of results from different studies through the
parameters of the Dirichlet prior.</p>
</div>
<div class="section level3">
<h3 id="total-load-shed-in-catchment">Total load shed in catchment<a class="anchor" aria-label="anchor" href="#total-load-shed-in-catchment"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ω</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\omega_t</annotation></semantics></math></p>
<div class="section level5">
<h5 id="option-1-without-individual-level-variation">Option 1: Without individual-level variation<a class="anchor" aria-label="anchor" href="#option-1-without-individual-level-variation"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>0</mn></mrow><mi>S</mi></munderover><msup><mi>μ</mi><mtext mathvariant="normal">load</mtext></msup><mspace width="0.167em"></mspace><msubsup><mi>τ</mi><mi>s</mi><mtext mathvariant="normal">shed</mtext></msubsup><mspace width="0.167em"></mspace><msub><mi>λ</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
\omega_t = \sum_{s=0}^S \mu^\text{load}\, \tau^\text{shed}_s\, \lambda_{t-s}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>μ</mi><mtext mathvariant="normal">load</mtext></msup><annotation encoding="application/x-tex">\mu^\text{load}</annotation></semantics></math>
is the average total shedding load per person (see
<code><a href="../articles/load_per_case.html">vignette("load_per_case")</a></code>),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\tau^\text{shed}</annotation></semantics></math>
the shedding load distribution (see above), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\lambda_{t}</annotation></semantics></math>
is the expected number of individuals with symptom onset on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
</div>
<div class="section level5">
<h5 id="option-2-with-individual-level-variation">Option 2: With individual-level variation<a class="anchor" aria-label="anchor" href="#option-2-with-individual-level-variation"></a>
</h5>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ω</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>0</mn></mrow><mi>S</mi></munderover><msup><mi>μ</mi><mtext mathvariant="normal">load</mtext></msup><mspace width="0.167em"></mspace><msubsup><mi>τ</mi><mi>s</mi><mtext mathvariant="normal">shed</mtext></msubsup><mspace width="0.167em"></mspace><msub><mi>ζ</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
\omega_t = \sum_{s=0}^S \mu^\text{load}\, \tau^\text{shed}_s\, \zeta_{t-s}
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>μ</mi><mtext mathvariant="normal">load</mtext></msup><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu^\text{load})</annotation></semantics></math>
is the average total shedding load per person and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>τ</mi><mtext mathvariant="normal">shed</mtext></msup><annotation encoding="application/x-tex">\tau^\text{shed}</annotation></semantics></math>
the shedding load distribution (see above). This is now multiplied by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\zeta_t</annotation></semantics></math>,
which is defined as the sum of i.i.d. Gamma distributed individual
relative shedding intensities with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
and coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ζ</mi></msub><annotation encoding="application/x-tex">\nu_\zeta</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ζ</mi><mi>t</mi></msub><mo>∼</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>Λ</mi><mi>t</mi></msub></munderover><mspace width="0.167em"></mspace><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">mean</mtext><mo>=</mo><mn>1</mn><mo>,</mo><mtext mathvariant="normal">cv</mtext><mo>=</mo><msub><mi>ν</mi><mi>ζ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>=</mo><mfrac><msub><mi>Λ</mi><mi>t</mi></msub><msubsup><mi>ν</mi><mi>ζ</mi><mn>2</mn></msubsup></mfrac><mo>,</mo><mi>β</mi><mo>=</mo><mfrac><mn>1</mn><msubsup><mi>ν</mi><mi>ζ</mi><mn>2</mn></msubsup></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\zeta_t \sim \sum_{i=1}^{\Lambda_t} \, \text{Gamma}(\text{mean} = 1, \text{cv} = \nu_\zeta) = \text{Gamma}(\alpha = \frac{\Lambda_t}{\nu_\zeta^2}, \beta = \frac{1}{\nu_\zeta^2})
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Λ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\Lambda_t</annotation></semantics></math>
is the realized number of symptom onsets. That is,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\zeta_t</annotation></semantics></math>
describes the number of individuals with symptom onset on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
weighted by their shedding intensity, where an intensity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">&lt;1</annotation></semantics></math>
indicates below-average shedding, and an intensity
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">&gt;1</annotation></semantics></math>
indicates above-average shedding. The coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ζ</mi></msub><annotation encoding="application/x-tex">\nu_\zeta</annotation></semantics></math>
describes how much the shedding intensity varies between
individuals.</p>
<p>We here approximate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Λ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\Lambda_t</annotation></semantics></math>
with its expectation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>t</mi></msub><mo>=</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda_t = E[\Lambda_t]</annotation></semantics></math>,
i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ζ</mi><mi>t</mi></msub><mo>∼</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>=</mo><mfrac><msub><mi>λ</mi><mi>t</mi></msub><msubsup><mi>ν</mi><mi>ζ</mi><mn>2</mn></msubsup></mfrac><mo>,</mo><mi>β</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msup><mi>μ</mi><mtext mathvariant="normal">load</mtext></msup><msubsup><mi>ν</mi><mi>ζ</mi><mn>2</mn></msubsup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\zeta_t \sim \text{Gamma}(\alpha = \frac{\lambda_t}{\nu_\zeta^2}, \beta = \frac{1}{\mu^\text{load} \nu_\zeta^2}),
\end{equation}</annotation></semantics></math></p>
<p>and place a zero-truncated normal prior on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ζ</mi></msub><annotation encoding="application/x-tex">\nu_\zeta</annotation></semantics></math>.</p>
<p>In the stan implementation, we improve sampling efficiency by using a
normal approximation of the Gamma distribution for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ζ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\zeta_t</annotation></semantics></math>
when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\lambda_t</annotation></semantics></math>
is large
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo>≈</mo><mn>30</mn><mo>×</mo><msubsup><mi>ν</mi><mi>ζ</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">E[\Lambda_t] \approx 30 \times \nu_\zeta^2</annotation></semantics></math>).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sewage-module">Sewage module<a class="anchor" aria-label="anchor" href="#sewage-module"></a>
</h2>
<div class="section level3">
<h3 id="load-at-sampling-site">Load at sampling site<a class="anchor" aria-label="anchor" href="#load-at-sampling-site"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\pi_t</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>π</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>d</mi><mo>=</mo><mn>0</mn></mrow><mi>D</mi></munderover><msub><mi>ω</mi><mrow><mi>t</mi><mo>−</mo><mi>d</mi></mrow></msub><mspace width="0.167em"></mspace><msubsup><mi>τ</mi><mi>d</mi><mtext mathvariant="normal">res</mtext></msubsup></mrow><annotation encoding="application/x-tex">\begin{equation}
\pi_t = \sum_{d=0}^D \omega_{t-d}\, \tau^\text{res}_d
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>τ</mi><mtext mathvariant="normal">res</mtext></msup><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msubsup><mi>τ</mi><mn>0</mn><mtext mathvariant="normal">res</mtext></msubsup><mo>,</mo><msubsup><mi>τ</mi><mn>1</mn><mtext mathvariant="normal">res</mtext></msubsup><mo>,</mo><mi>…</mi><mo>,</mo><msubsup><mi>τ</mi><mi>D</mi><mtext mathvariant="normal">res</mtext></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\tau^\text{res} = (\tau^\text{res}_0, \tau^\text{res}_1, \dots, \tau^\text{res}_D))</annotation></semantics></math>
is the sewer residence time distribution of pathogen particles.</p>
</div>
<div class="section level3">
<h3 id="concentration-at-sampling-site">Concentration at sampling site<a class="anchor" aria-label="anchor" href="#concentration-at-sampling-site"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>χ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\chi_t</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>χ</mi><mi>t</mi></msub><mo>=</mo><mfrac><msub><mi>π</mi><mi>t</mi></msub><msub><mtext mathvariant="normal">flow</mtext><mi>t</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">\begin{equation}
\chi_t = \frac{\pi_t}{\text{flow}_t}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mtext mathvariant="normal">flow</mtext><mi>t</mi></msub><annotation encoding="application/x-tex">\text{flow}_t</annotation></semantics></math>
is a measure of the total wastewater volume upstream from the sampling
site on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level2">
<h2 id="sampling-module">Sampling module<a class="anchor" aria-label="anchor" href="#sampling-module"></a>
</h2>
<div class="section level3">
<h3 id="concentration-in-single-day-samples-with-sample-effects-and-outliers">Concentration in single-day samples, with sample effects and
outliers<a class="anchor" aria-label="anchor" href="#concentration-in-single-day-samples-with-sample-effects-and-outliers"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>κ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\kappa_t</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>κ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>χ</mi><mi>t</mi></msub><mo>+</mo><mi>𝐗</mi><mspace width="0.167em"></mspace><mi>η</mi><mo>+</mo><msub><mi>ϵ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
\kappa_t = \chi_t + \boldsymbol{X} \, \eta + \epsilon_t
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\boldsymbol{X}</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">T \times K</annotation></semantics></math>
design matrix of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
different covariates describing the characteristics of samples on days 1
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>η</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>η</mi><mn>1</mn></msub><mo>,</mo><msub><mi>η</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>η</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\eta = (\eta_1, \eta_2, \dots, \eta_K)</annotation></semantics></math>
is a vector of coefficients which estimate the association of the sample
covariates with the concentration. We place independent normal priors on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>η</mi><mn>1</mn></msub><mo>,</mo><msub><mi>η</mi><mn>2</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>η</mi><mi>K</mi></msub></mrow><annotation encoding="application/x-tex">\eta_1, \eta_2, \dots, \eta_K</annotation></semantics></math>.</p>
<p>Moreover,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>t</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\epsilon_t&gt;0</annotation></semantics></math>
represents positive outlier concentrations that violate the uniform
mixing assumption. We place a heavily right-tailed Type II extreme value
prior on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ϵ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\epsilon_t</annotation></semantics></math>.
By default, parameters are chosen such that 99% of the probability mass
is below a concentration that would be observable from one infection in
the catchment.</p>
<p>Note that if on some days no samples were taken, the corresponding
row of the sample effects design matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐗</mi><annotation encoding="application/x-tex">\boldsymbol{X}</annotation></semantics></math>
can be filled with arbitrary values, since they will not contribute to
the likelihood. To estimate weekday effects, EpiSewer provides a
function <code>vignette("sample_effects_estimate_weekday")</code> that
automatically creates a design matrix for the day of the week.</p>
</div>
<div class="section level3">
<h3 id="concentration-in-multi-day-composite-samples">Concentration in multi-day composite samples<a class="anchor" aria-label="anchor" href="#concentration-in-multi-day-composite-samples"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ρ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\rho_t</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ρ</mi><mi>t</mi></msub><mo>=</mo><mfrac><mn>1</mn><mi>w</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>w</mi><mo>−</mo><mn>1</mn></mrow></munderover><msub><mi>κ</mi><mrow><mi>t</mi><mo>−</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
\rho_t = \frac{1}{w} \sum_{i=0}^{w-1} \kappa_{t-i}
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
is the composite window size, i.e. the number of consecutive single-day
samples that are equivolumetrically mixed into a composite sample. Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is the day of the latest sample.</p>
</div>
</div>
<div class="section level2">
<h2 id="measurements-module">Measurements module<a class="anchor" aria-label="anchor" href="#measurements-module"></a>
</h2>
<div class="section level3">
<h3 id="analysed-concentration-before-replication">Analysed concentration before replication<a class="anchor" aria-label="anchor" href="#analysed-concentration-before-replication"></a>
</h3>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ψ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\Psi_t</annotation></semantics></math></p>
<p>We model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Ψ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\Psi_t</annotation></semantics></math>
as Log-Normal distributed with unit-scale mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ρ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\rho_t</annotation></semantics></math>
(sample concentration) and unit-scale coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ψ</mi></msub><annotation encoding="application/x-tex">\nu_\psi</annotation></semantics></math>,
i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ψ</mi><mi>t</mi></msub><mo>∼</mo><mtext mathvariant="normal">Log-Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>Ψ</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><msubsup><mi>σ</mi><mi>Ψ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{equation}
\Psi_t \sim \text{Log-Normal}\left(\mu_\Psi,\, \sigma_\Psi^2\right)
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mi>Ψ</mi></msub><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ρ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>σ</mi><mi>Ψ</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">\mu_\Psi = \log(\rho_t) - \frac{1}{2}\sigma_\Psi^2</annotation></semantics></math>
is the location and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>σ</mi><mi>Ψ</mi><mn>2</mn></msubsup><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><msubsup><mi>ν</mi><mi>Ψ</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\sigma_\Psi^2 = \log(1 + \nu_\Psi^2)</annotation></semantics></math>
is the scale of the Log-Normal distribution. Here,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ψ</mi></msub><annotation encoding="application/x-tex">\nu_\psi</annotation></semantics></math>
measures the unexplained variation in concentrations before the
replication stage (for example, if you provide technical PCR replicates,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ψ</mi></msub><annotation encoding="application/x-tex">\nu_\psi</annotation></semantics></math>
measures all variation before the PCR). We place a zero-truncated normal
prior on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>ψ</mi></msub><annotation encoding="application/x-tex">\nu_\psi</annotation></semantics></math>.</p>
<p>Note that pre-replication variation is only modeled when providing
replicate measurements to EpiSewer and specifying
<code>replicates = TRUE</code> in the <code>noise_estimate_</code>
component.</p>
</div>
<div class="section level3">
<h3 id="measured-concentration">Measured concentration<a class="anchor" aria-label="anchor" href="#measured-concentration"></a>
</h3>
<div class="section level4">
<h4 id="non-detects">Non-detects<a class="anchor" aria-label="anchor" href="#non-detects"></a>
</h4>
<p>EpiSewer implements a hurdle model to account for non-detects
(i.e. zero measurements). This is closely related to the limit of
detection (LOD), below which sample concentrations cannot be reliably
detected (typically defined as less than 95% probability of
detection).</p>
<div class="section level5">
<h5 id="option-1-assumed-lod">Option 1: Assumed LOD<a class="anchor" aria-label="anchor" href="#option-1-assumed-lod"></a>
</h5>
<p>This option models the probability of non-detection as an
exponentially decreasing function of the underlying concentration,
i.e. </p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Ψ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><msub><mi>ψ</mi><mi>t</mi></msub><mspace width="0.167em"></mspace><mi>b</mi></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
P(\Upsilon_{t,i} = 0 | \Psi_t = \psi_t) = e^{-\psi_t\, b},
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\Upsilon_{t,i}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">i^{\text{th}}</annotation></semantics></math>
replicate concentration measurement from the (composite) sample on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
is calculated from an LOD value provided by the user, typically
established from a lab experiment. For example, if the LOD was defined
as the lowest concentration for which the detection probability was
still above 95%, then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mo>−</mo><mtext mathvariant="normal">log</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mn>0.95</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mtext mathvariant="normal">LOD</mtext></mrow><annotation encoding="application/x-tex">b = -\text{log}(1-0.95)/\text{LOD}</annotation></semantics></math>.</p>
<p>Given the probability of non-detection, the probability for a
non-zero measurement is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Ψ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Υ</mi><mi>t</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Ψ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
P(\Upsilon_{t,i} &gt; 0 | \Psi_t = \psi_t) = 1 - P(\Upsilon_t = 0 | \Psi_t = \psi_t).
\end{equation}</annotation></semantics></math></p>
</div>
<div class="section level5">
<h5 id="option-2-non-detection-in-digital-pcr-dpcr">Option 2: Non-detection in digital PCR (dPCR)<a class="anchor" aria-label="anchor" href="#option-2-non-detection-in-digital-pcr-dpcr"></a>
</h5>
<p>This option models the probability of non-detection based on the
statistical properties of digital PCR assays, using a binomial
likelihood for zero successes. This depends on several parameters of the
assay, such as the number and volume of partitions - which can be either
assumed or estimated. by EpiSewer. Please see <a href="https://doi.org/10.1101/2024.10.14.618307" class="external-link">this preprint</a> for
details.</p>
</div>
</div>
<div class="section level4">
<h4 id="non-zero-measurements">Non-zero measurements<a class="anchor" aria-label="anchor" href="#non-zero-measurements"></a>
</h4>
<p>Variable:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\Upsilon_{t,i}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\Upsilon_{t,i}</annotation></semantics></math>
represents the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>i</mi><mtext mathvariant="normal">th</mtext></msup><annotation encoding="application/x-tex">i^{\text{th}}</annotation></semantics></math>
replicate concentration measurement from the (composite) sample on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
Non-zero concentration measurements
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\Upsilon_{t,i} &gt; 0</annotation></semantics></math>
are modeled using a positive continuous distribution (Gamma by default,
but Log-Normal and Truncated Normal are also available). This
distribution is parameterized by its mean and coefficient of
variation.</p>
<p>For the mean, we assume unbiased measurements, such that in principle
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub></msub><mo>=</mo><msub><mi>ψ</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\mu_{\Upsilon_{t,i}} = \psi_t</annotation></semantics></math>.
Nevertheless, the mean of non-zero measurements must be adjusted for the
conditioning on detection, i.e.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>μ</mi><mrow><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mspace width="0.167em"></mspace><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow></msub><mo>=</mo><mfrac><msub><mi>ψ</mi><mi>t</mi></msub><mrow><mn>1</mn><mo>−</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Υ</mi><mi>t</mi></msub><mo>=</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>Ψ</mi><mi>t</mi></msub><mo>=</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
\mu_{\Upsilon_{t,i} \,|\, \Upsilon_{t,i} &gt; 0} = \frac{\psi_t}{1 - P(\Upsilon_t = 0 | \Psi_t = \psi_t)},
\end{equation}</annotation></semantics></math></p>
<p>For the coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ν</mi><mi>Υ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nu_\Upsilon(\psi_t)</annotation></semantics></math>,
EpiSewer currently offers three options (see below). In all cases,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ν</mi><mi>Υ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nu_\Upsilon(\psi_t)</annotation></semantics></math>
describes all remaining unexplained variation in the measurements. This
means that if replicates are provided and variation before the
replication stage is already accounted for (see above), then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ν</mi><mi>Υ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\nu_\Upsilon(\psi_t)</annotation></semantics></math>
describes only the variation between the replicates. Otherwise it will
also include variation before the replication stage.</p>
<div class="section level5">
<h5 id="option-1-constant-cv">Option 1: Constant CV<a class="anchor" aria-label="anchor" href="#option-1-constant-cv"></a>
</h5>
<p>This option assumes a constant coefficient of variation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>Υ</mi></msub><annotation encoding="application/x-tex">\nu_\Upsilon</annotation></semantics></math>
for all measurements, i.e.
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ν</mi><mi>Υ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>ν</mi><mi>Υ</mi></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
\nu_\Upsilon(\psi_t) = \nu_\Upsilon
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>Υ</mi></msub><annotation encoding="application/x-tex">\nu_\Upsilon</annotation></semantics></math>
is a parameter to be estimated. We place a zero-truncated normal prior
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ν</mi><mi>Υ</mi></msub><annotation encoding="application/x-tex">\nu_\Upsilon</annotation></semantics></math>.</p>
</div>
<div class="section level5">
<h5 id="option-2-cv-based-on-digital-pcr-dpcr">Option 2: CV based on digital PCR (dPCR)<a class="anchor" aria-label="anchor" href="#option-2-cv-based-on-digital-pcr-dpcr"></a>
</h5>
<p>This option models the CV as a function of the expected concentration
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ψ</mi><mi>t</mi></msub><annotation encoding="application/x-tex">\psi_t</annotation></semantics></math>,
and the functional relationship is derived from the statistical
properties of digital PCR assays, i.e. based on the binomial-distributed
positive partition counts in the dPCR reaction. As a result, the CV is
approximately constant for high concentrations, but increases
exponentially as concentrations become small (it also increases when
concentrations become so large that the assay saturates, but this should
be avoided in lab practice through appropriate dilution). The exact
functional relationship depends on several parameters of the assay, such
as the number and volume of partitions - which can be either assumed or
estimated. by EpiSewer. Please see <a href="https://doi.org/10.1101/2024.10.14.618307" class="external-link">this preprint</a> for
details.</p>
</div>
<div class="section level5">
<h5 id="option-3-constant-variance">Option 3: Constant variance<a class="anchor" aria-label="anchor" href="#option-3-constant-variance"></a>
</h5>
<p>This option models measurements with a constant variance
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><mi>Υ</mi><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma^2_\Upsilon</annotation></semantics></math>,
such that</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ν</mi><mi>Υ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>ψ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><msub><mi>σ</mi><mi>Υ</mi></msub><msub><mi>ψ</mi><mi>t</mi></msub></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">\begin{equation}
\nu_\Upsilon(\psi_t) = \frac{\sigma_\Upsilon}{\psi_t}.
\end{equation}</annotation></semantics></math></p>
<p>This option is not recommended for use in practice, as it is likely
misspecified for most types of measurements.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h2>
<p><code>EpiSewer</code> is directly fitted to observed concentration
measurements
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">y_{t,i}</annotation></semantics></math>
(where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>≤</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">t \leq T</annotation></semantics></math>
is the index of the sample date and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
the index of the replicate out of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>t</mi></msub><annotation encoding="application/x-tex">n_t</annotation></semantics></math>
replicates in total for date index
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>).</p>
<p>Using Markov Chain Monte Carlo (MCMC), we draw samples from the joint
posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
and the other parameters</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>G</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo></mrow></msub><mo>,</mo><mi>…</mi><mspace width="0.278em"></mspace><mo stretchy="true" form="infix">|</mo><mspace width="0.278em"></mspace><msub><mi>y</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mrow><mo stretchy="true" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>L</mi><mo>+</mo><mi>S</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo stretchy="true" form="postfix">|</mo></mrow><mi>i</mi><mo>≤</mo><msub><mi>n</mi><mi>t</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>∝</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mrow><mo stretchy="true" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>L</mi><mo>+</mo><mi>S</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo stretchy="true" form="postfix">|</mo></mrow><mi>i</mi><mo>≤</mo><msub><mi>n</mi><mi>t</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow></msub><mspace width="0.278em"></mspace><mo stretchy="true" form="infix">|</mo><mspace width="0.278em"></mspace><msub><mi>R</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>G</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo></mrow></msub><mo>,</mo><mi>…</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>…</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
P\left(R_{\{t | 1+G \leq t \leq T\}}, \dots \;\middle|\; y_{\{t | 1+L+S \leq t \leq T\},\{i | i \leq n_t\}}\right) \propto P\left(y_{\{t | 1+L+S \leq  t \leq T\},\{i | i \leq n_t\}} \;\middle|\; R_{\{t | 1+G \leq t \leq T\}}, \dots\right) \, P\left(\dots \right),
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mrow><mo stretchy="true" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>L</mi><mo>+</mo><mi>S</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo><mo>,</mo><mo stretchy="false" form="prefix">{</mo><mi>i</mi><mo stretchy="true" form="postfix">|</mo></mrow><mi>i</mi><mo>≤</mo><msub><mi>n</mi><mi>t</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow></msub><mspace width="0.278em"></mspace><mo stretchy="true" form="infix">|</mo><mspace width="0.278em"></mspace><msub><mi>R</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><mn>1</mn><mo>+</mo><mi>G</mi><mo>≤</mo><mi>t</mi><mo>≤</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo></mrow></msub><mo>,</mo><mi>…</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(y_{\{t | 1+L+S \leq t \leq T\},\{i | i \leq n_t\}} \;\middle|\; R_{\{t | 1+G \leq t \leq T\}}, \dots\right)</annotation></semantics></math>
is the likelihood as defined by the 5 modules of our generative model
(infection, shedding, sewage, sampling, and measurement), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>…</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">P\left(\dots \right)</annotation></semantics></math>
represents the priors on the non-hierarchical parameters of the model
(e.g. intercepts and variances of random walks).</p>
<p>Note that many variables in the generative model (including
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>!)
are in fact only transformations of other variables and therefore do not
count as model parameters in a strict sense.</p>
</div>
<div class="section level2">
<h2 id="indexing-of-time">Indexing of time<a class="anchor" aria-label="anchor" href="#indexing-of-time"></a>
</h2>
<p>For ease of notation, we have here used a unified time index
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>T</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">t \in \{1, 2, \dots, T\}</annotation></semantics></math>
for all variables. In reality, to model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Υ</mi><mrow><mi>t</mi><mo>,</mo><mi>i</mi></mrow></msub><annotation encoding="application/x-tex">\Upsilon_{t,i}</annotation></semantics></math>
at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t=1</annotation></semantics></math>,
we need to model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
and many other variables also at earlier time points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t&lt;1</annotation></semantics></math>
due to the various delays between infections and observations. In the
model implementation, each variable therefore has its own time index,
and indices are mapped to each other accordingly.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian Lison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
