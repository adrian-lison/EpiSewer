<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Rt via smoothing splines — R_estimate_splines • EpiSewer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Rt via smoothing splines — R_estimate_splines"><meta name="description" content="This option estimates the effective reproduction number Rt using
penalized cubic basis splines."><meta property="og:description" content="This option estimates the effective reproduction number Rt using
penalized cubic basis splines."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiSewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/model-specification.html">Modeling in EpiSewer</a></li>
    <li><a class="dropdown-item" href="../articles/detailed-example.html">Detailed example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling details</h6></li>
    <li><a class="dropdown-item" href="../articles/model-definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/load_per_case.html">The "shedding load per case" assumption</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrian-lison/EpiSewer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Rt via smoothing splines</h1>
      <small class="dont-index">Source: <a href="https://github.com/adrian-lison/EpiSewer/blob/v0.0.4/R/model_infections.R" class="external-link"><code>R/model_infections.R</code></a></small>
      <div class="d-none name"><code>R_estimate_splines.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This option estimates the effective reproduction number Rt using
penalized cubic basis splines.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">R_estimate_splines</span><span class="op">(</span></span>
<span>  knot_distance_global <span class="op">=</span> <span class="fl">4</span> <span class="op">*</span> <span class="fl">7</span>,</span>
<span>  knot_distance_local <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  R_start_prior_mu <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  R_start_prior_sigma <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  R_sd_local_prior_mu <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  R_sd_local_prior_sd <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  R_sd_global_prior_shape <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  R_sd_global_prior_scale <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  R_sd_global_change_distance <span class="op">=</span> <span class="va">knot_distance_global</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"inv_softplus"</span>,</span>
<span>  R_max <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  modeldata <span class="op">=</span> <span class="fu"><a href="modeldata_init.html">modeldata_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-knot-distance-global">knot_distance_global<a class="anchor" aria-label="anchor" href="#arg-knot-distance-global"></a></dt>
<dd><p>Distance between spline breakpoints (knots) for
the <em>global</em> spline in days. <code>EpiSewer</code> uses an ensemble of two splines to
model Rt. The global spline models larger, long-term changes. Default is
4*7, i.e. one knot every four week.</p></dd>


<dt id="arg-knot-distance-local">knot_distance_local<a class="anchor" aria-label="anchor" href="#arg-knot-distance-local"></a></dt>
<dd><p>Distance between spline breakpoints (knots) for the
<em>local</em> spline in days. <code>EpiSewer</code> uses an ensemble of two splines to model
Rt. The local spline models smaller, short-term changes. Default is 7, i.e.
one knot each week.</p></dd>


<dt id="arg-r-start-prior-mu">R_start_prior_mu<a class="anchor" aria-label="anchor" href="#arg-r-start-prior-mu"></a></dt>
<dd><p>Prior (mean) on the initial reproduction number
(intercept).</p></dd>


<dt id="arg-r-start-prior-sigma">R_start_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-r-start-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) on the initial
reproduction number (intercept).</p></dd>


<dt id="arg-r-sd-local-prior-mu">R_sd_local_prior_mu<a class="anchor" aria-label="anchor" href="#arg-r-sd-local-prior-mu"></a></dt>
<dd><p>Prior (mean) for the variation of the local (i.e.
short-term) spline. This controls the standard deviation of a random walk
over the coefficients of the local spline. The prior refers to the <em>daily</em>
standard deviation and is thus independent of the knot distance.</p></dd>


<dt id="arg-r-sd-local-prior-sd">R_sd_local_prior_sd<a class="anchor" aria-label="anchor" href="#arg-r-sd-local-prior-sd"></a></dt>
<dd><p>Prior (standard deviation) for the variation of the
local (i.e. short-term) spline. See <code>R_sd_local_prior_mu</code> for details.</p></dd>


<dt id="arg-r-sd-global-prior-shape">R_sd_global_prior_shape<a class="anchor" aria-label="anchor" href="#arg-r-sd-global-prior-shape"></a></dt>
<dd><p>Exponential-Gamma prior (shape) for the
variation of the global (i.e. long-term) spline. This controls the standard
deviation of a random walk over the coefficients of the global spline. The
prior refers to the <em>daily</em> standard deviation and is thus independent of
the knot distance. The exponential-Gamma prior is sparse, i.e. it has a
strong peak towards zero and a long tail. Smaller shape parameters will lead
to more sparseness, i.e. a longer tail. Note that when adjusting the shape,
you will likely also have to adjust the scale. The variation of the global
splines follows a change point model to allow for adaptive changes, see
details for more explanation.</p></dd>


<dt id="arg-r-sd-global-prior-scale">R_sd_global_prior_scale<a class="anchor" aria-label="anchor" href="#arg-r-sd-global-prior-scale"></a></dt>
<dd><p>Exponential-Gamma prior (scale) for the
variation of the global (i.e. long-term) spline. Larger scales will lead to
more variability. See <code>R_sd_global_prior_shape</code> and the details for more
explanation about this prior.</p></dd>


<dt id="arg-r-sd-global-change-distance">R_sd_global_change_distance<a class="anchor" aria-label="anchor" href="#arg-r-sd-global-change-distance"></a></dt>
<dd><p>Distance between changepoints used to model
global variation in Rt. <code>EpiSewer</code> uses an adaptive model for the variation
of the global spline, to model both time periods with stable and with
volatile transmission dynamics. The default change point distance is equal
to <code>knot_distance_global</code>. Making this smaller than the global knot distance
will not have a large effect, however making this longer reduces the
adaptability of the Rt variation. If set to zero, no change points are
modeled, meaning zero adaptability.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>Link function. Currently supported are <code>inv_softplus</code> (default)
and <code>scaled_logit</code>. Both of these links are configured to behave
approximately like the identity function around R=1, but become increasingly
non-linear below (and in the case of <code>scaled_logit</code> also above) R=1.</p></dd>


<dt id="arg-r-max">R_max<a class="anchor" aria-label="anchor" href="#arg-r-max"></a></dt>
<dd><p>If <code>link=scaled_logit</code> is used, a maximum reproduction number
must be assumed. This should be higher than any realistic R value for the
modeled pathogen. Default is 6.</p></dd>


<dt id="arg-modeldata">modeldata<a class="anchor" aria-label="anchor" href="#arg-modeldata"></a></dt>
<dd><p>A <code>modeldata</code> object to which the above model specifications
should be added. Default is an empty model given by <code><a href="modeldata_init.html">modeldata_init()</a></code>. Can
also be an already partly specified model returned by other <code>EpiSewer</code>
modeling functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>modeldata</code> object containing data and specifications of the model
to be fitted. Can be passed on to other <code>EpiSewer</code> modeling functions to
add further data and model specifications.</p>
<p>The <code>modeldata</code> object also includes information about parameter
initialization (<code>.init</code>), meta data (<code>.metainfo</code>), and checks to be
performed before model fitting (<code>.checks</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>EpiSewer</code> uses a combination of two splines (global, for
larger/long-term changes and local, for smaller/short-term changes), with a
random walk on the coefficients of each spline. This allows a highly
adaptive yet regularized Rt model.</p><ul><li><p>The prior <code>R_start_prior</code> should reflect
your expectation of Rt at the beginning of the time series. If your time
series starts in the midst of an outbreak, you might want to use a prior
with mean larger than 1 for the intercept.</p></li>
<li><p>The prior <code>R_sd_local_prior</code> on the standard deviation of the local
spline coefficients should be interpreted in terms of daily additive changes
(this is accurate around Rt=1, and becomes less accurate as Rt approaches 0
or its upper bound as defined by the <code>link</code> function). For example, a
baseline half-normal prior with sd=0.05 allows a daily standard deviation
between 0 and 0.1. A daily standard deviation of 0.1 in turn roughly allows
the spline coefficients to change by ±0.2 (using the 2 sigma rule) each day.
The daily standard deviation is summed up over the days between two knots to
get the actual standard deviation of the coefficients. This way, the prior
is independent of the chosen <code>knot_distance</code>. For example, if
<code>knot_distance</code> is 7 days, and a constant daily standard deviation of 0.1 is
estimated, the coefficients of two adjacent splines can differ by up to
<code>0.2*sqrt(knot_distance)</code>, i.e. ±0.5. Note however that this does not
directly translate into a change of Rt by ±0.5, as Rt is always the weighted
sum of several basis functions at any given point. It will therefore change
more gradually, depending on the distances between knots.</p></li>
<li><p>The prior <code>R_sd_global_prior</code> on the standard deviation of the global
spline coefficients is interpreted in the same way as the local spline, i.e.
it describes daily additive changes. However, we us a <em>sparse</em> prior for the
global variation, combined with a changepoint model. This yields a global
spline that expects small changes most of the time but allows for occasional
large changes. For example, during the height of an epidemic wave,
countermeasures may lead to much faster changes in Rt than observable at
other times. These differences in variability are accounted for using change
points placed at regular intervals, with the daily global standard deviation
evolving linearly between the change points. The values at the changepoints
are modeled as independently distributed and follow the Exponential-Gamma
(EG) prior distribution defined by <code>R_sd_global_prior</code>. The EG distribution
is also known as Lomax distribution and corresponds to an exponential
distribution with a Gamma distributed rate parameter.</p></li>
</ul><p>The smoothness of the Rt estimates is influenced by a combination of
the global and local knot distances and by the priors on the global and
local standard deviation of the random walk on spline coefficients. Placing
knots further apart increases the smoothness of Rt estimates and can speed
up model fitting. The Rt time series remains surprisingly flexible even at
larger knot distances, but placing knots too far apart can lead to
inaccurate estimates. Note that the priors for the variation of the global
and local random walk also influence the uncertainty of Rt estimates towards
the present / date of estimation, when limited data signal is available.
Absent sufficient data signal, Rt estimates will tend to stay at the current
level (which corresponds to assuming unchanged transmission dynamics).</p>
<p>The priors of this component have the following functional form:</p><ul><li><p>initial Rt (intercept):
<code>Normal</code></p></li>
<li><p>daily standard deviation of the random walk over local spline coefficients:
<code>Half-normal</code></p></li>
<li><p>daily standard deviation of the random walk over global spline coefficients:
<code>Exponential-Gamma</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Rt models:
<code><a href="R_estimate_approx.html">R_estimate_approx()</a></code>,
<code><a href="R_estimate_changepoint_splines.html">R_estimate_changepoint_splines()</a></code>,
<code><a href="R_estimate_ets.html">R_estimate_ets()</a></code>,
<code><a href="R_estimate_gp.html">R_estimate_gp()</a></code>,
<code><a href="R_estimate_piecewise.html">R_estimate_piecewise()</a></code>,
<code><a href="R_estimate_rw.html">R_estimate_rw()</a></code>,
<code><a href="R_estimate_smooth_derivative.html">R_estimate_smooth_derivative()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian Lison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

