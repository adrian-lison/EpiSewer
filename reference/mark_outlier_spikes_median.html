<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Mark outlier spikes in a measurement time series — mark_outlier_spikes_median • EpiSewer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mark outlier spikes in a measurement time series — mark_outlier_spikes_median"><meta name="description" content="
Uses a simple heuristic to detect positive outliers (i.e. unusually high
spikes) in a time series. The approach is to compare a measurement with the
median of measurements in a small centered window. If the measurements before
and after are considerably lower than the current measurement, the median
will also be much lower. This is used as a criterion to determine outliers."><meta property="og:description" content="
Uses a simple heuristic to detect positive outliers (i.e. unusually high
spikes) in a time series. The approach is to compare a measurement with the
median of measurements in a small centered window. If the measurements before
and after are considerably lower than the current measurement, the median
will also be much lower. This is used as a criterion to determine outliers."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiSewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/model-specification.html">Modeling in EpiSewer</a></li>
    <li><a class="dropdown-item" href="../articles/detailed-example.html">Detailed example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling details</h6></li>
    <li><a class="dropdown-item" href="../articles/model-definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/load_per_case.html">The "shedding load per case" assumption</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrian-lison/EpiSewer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mark outlier spikes in a measurement time series</h1>
      <small class="dont-index">Source: <a href="https://github.com/adrian-lison/EpiSewer/blob/v0.0.3/R/utils_preprocess.R" class="external-link"><code>R/utils_preprocess.R</code></a></small>
      <div class="d-none name"><code>mark_outlier_spikes_median.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>Uses a simple heuristic to detect positive outliers (i.e. unusually high
spikes) in a time series. The approach is to compare a measurement with the
median of measurements in a small centered window. If the measurements before
and after are considerably lower than the current measurement, the median
will also be much lower. This is used as a criterion to determine outliers.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mark_outlier_spikes_median</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">measurement_col</span>,</span>
<span>  date_col <span class="op">=</span> <span class="va">date</span>,</span>
<span>  window <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  threshold_factor <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  mad_window <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  mad_lower_quantile <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A <code>data.frame</code> containing the time series of measurements.</p></dd>


<dt id="arg-measurement-col">measurement_col<a class="anchor" aria-label="anchor" href="#arg-measurement-col"></a></dt>
<dd><p>The name of the column with the measurements. Use
dplyr-style env-variables, not characters.</p></dd>


<dt id="arg-date-col">date_col<a class="anchor" aria-label="anchor" href="#arg-date-col"></a></dt>
<dd><p>The name of the column with corresponding dates. Use
dplyr-style env-variables, not characters.</p></dd>


<dt id="arg-window">window<a class="anchor" aria-label="anchor" href="#arg-window"></a></dt>
<dd><p>The size of the centered window for computing the median.</p></dd>


<dt id="arg-threshold-factor">threshold_factor<a class="anchor" aria-label="anchor" href="#arg-threshold-factor"></a></dt>
<dd><p>Beyond how many median absolute deviations from the
median should a measurement be marked as outlier?</p></dd>


<dt id="arg-mad-window">mad_window<a class="anchor" aria-label="anchor" href="#arg-mad-window"></a></dt>
<dd><p>The size of the right-aligned, one-day-lagged window for
the mean absolute deviation. This should be longer than the window for the
median.</p></dd>


<dt id="arg-mad-lower-quantile">mad_lower_quantile<a class="anchor" aria-label="anchor" href="#arg-mad-lower-quantile"></a></dt>
<dd><p>At what quantile should the lower bound for the
expected noise be? This is used to avoid false positives when concentration
levels are very low.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The provided <code>data.frame</code>, with an additional logical column
<code>is_outlier</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To determine how much deviation from the median is significant, a
moving median absolute deviation (as a more robust estimate than the
standard deviation of how much noise to expect) in measurements is used.
This seems to be more robust than just multiplying the median with a factor
to determine the threshold. The moving MAD is lagged by one day such that
the current value is not included. Moreover, note that because the window
for the moving median is centered, the last window_size/2 dates have no
spike detection.</p>
<p>The method also allows for multiple measurements per day
(replicates), where each replicate is evaluated individually. However, this
currently does not give more weight to days with more replicates, i.e.
ignores potential differences in measurement uncertainty.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian Lison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

