<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Rt using Gaussian processes — R_estimate_gp • EpiSewer</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Rt using Gaussian processes — R_estimate_gp"><meta name="description" content="This option estimates the effective reproduction number Rt over
time using a Gaussian process (GP) model. There are two GPs: one for the
long-term trend in Rt, and one for short-term deviations from this trend."><meta property="og:description" content="This option estimates the effective reproduction number Rt over
time using a Gaussian process (GP) model. There are two GPs: one for the
long-term trend in Rt, and one for short-term deviations from this trend."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EpiSewer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/model-specification.html">Modeling in EpiSewer</a></li>
    <li><a class="dropdown-item" href="../articles/detailed-example.html">Detailed example</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modeling details</h6></li>
    <li><a class="dropdown-item" href="../articles/model-definition.html">Model definition</a></li>
    <li><a class="dropdown-item" href="../articles/load_per_case.html">The "shedding load per case" assumption</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/adrian-lison/EpiSewer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Estimate Rt using Gaussian processes</h1>
      <small class="dont-index">Source: <a href="https://github.com/adrian-lison/EpiSewer/blob/v0.0.4/R/model_infections.R" class="external-link"><code>R/model_infections.R</code></a></small>
      <div class="d-none name"><code>R_estimate_gp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This option estimates the effective reproduction number Rt over
time using a Gaussian process (GP) model. There are two GPs: one for the
long-term trend in Rt, and one for short-term deviations from this trend.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">R_estimate_gp</span><span class="op">(</span></span>
<span>  R_intercept_prior_mu <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  R_intercept_prior_sigma <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  length_scale_prior_mu <span class="op">=</span> <span class="fl">7</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  length_scale_prior_sigma <span class="op">=</span> <span class="fl">7</span><span class="op">/</span><span class="fl">2</span>,</span>
<span>  magnitude_prior_mu <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  magnitude_prior_sigma <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  long_length_scale_prior_mu <span class="op">=</span> <span class="fl">7</span> <span class="op">*</span> <span class="fl">4</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  long_length_scale_prior_sigma <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  long_magnitude_prior_mu <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  long_magnitude_prior_sigma <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  matern_nu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  boundary_factor <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  n_basis_factor <span class="op">=</span> <span class="fl">3.42</span>,</span>
<span>  link <span class="op">=</span> <span class="st">"inv_softplus"</span>,</span>
<span>  R_max <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  modeldata <span class="op">=</span> <span class="fu"><a href="modeldata_init.html">modeldata_init</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-r-intercept-prior-mu">R_intercept_prior_mu<a class="anchor" aria-label="anchor" href="#arg-r-intercept-prior-mu"></a></dt>
<dd><p>Prior (mean) for the intercept of Rt. Should be
set to 1 unless you have a clear a priori expectation of the average Rt
during the modeled time period.</p></dd>


<dt id="arg-r-intercept-prior-sigma">R_intercept_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-r-intercept-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) for the intercept
of Rt. By default, we fix <code>R_intercept</code> to 1 by setting
<code>R_intercept_prior_sigma=0</code>. This is because deviations from Rt=1 are
already captured by the long-term trend component (see below).</p></dd>


<dt id="arg-length-scale-prior-mu">length_scale_prior_mu<a class="anchor" aria-label="anchor" href="#arg-length-scale-prior-mu"></a></dt>
<dd><p>Prior (mean) on the length scale of the
short-term Gaussian process (in days). This influences the smoothness of
Rt. A higher length scale means that the Rt will change more slowly.
Choosing a length scale that is too short can lead to overfitting of the Rt
trajectory, while choosing a length scale that is too long can result in
unrealistically smooth Rt estimates.</p></dd>


<dt id="arg-length-scale-prior-sigma">length_scale_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-length-scale-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) on the length
scale of the short-term Gaussian process. Set to zero to fix the length
scale.</p></dd>


<dt id="arg-magnitude-prior-mu">magnitude_prior_mu<a class="anchor" aria-label="anchor" href="#arg-magnitude-prior-mu"></a></dt>
<dd><p>Prior (mean) on the magnitude of the short-term
Gaussian process. Can be approximately interpreted as the marginal standard
deviation of Rt. A higher magnitude allows more extreme Rt values.</p></dd>


<dt id="arg-magnitude-prior-sigma">magnitude_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-magnitude-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) on the magnitude of
the short-term Gaussian process. Set to zero to fix the magnitude.</p></dd>


<dt id="arg-long-length-scale-prior-mu">long_length_scale_prior_mu<a class="anchor" aria-label="anchor" href="#arg-long-length-scale-prior-mu"></a></dt>
<dd><p>Prior (mean) on the length scale of the
long-term Gaussian process (in days). This should be quite long, at least
several times the mean shedding delay of the pathogen, and significantly
larger than the mean prior for the short-term GP (<code>length_scale_prior_mu</code>).</p></dd>


<dt id="arg-long-length-scale-prior-sigma">long_length_scale_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-long-length-scale-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) on the length
scale of the long-term Gaussian process. Set to zero to fix the length
scale.</p></dd>


<dt id="arg-long-magnitude-prior-mu">long_magnitude_prior_mu<a class="anchor" aria-label="anchor" href="#arg-long-magnitude-prior-mu"></a></dt>
<dd><p>Prior (mean) on the magnitude of the long-term
Gaussian process. Can be approximately interpreted as the marginal standard
deviation of the long-term Rt trend. A higher magnitude allows more extreme
Rt values.</p></dd>


<dt id="arg-long-magnitude-prior-sigma">long_magnitude_prior_sigma<a class="anchor" aria-label="anchor" href="#arg-long-magnitude-prior-sigma"></a></dt>
<dd><p>Prior (standard deviation) on the magnitude
of the long-term Gaussian process. Set to zero to fix the magnitude.</p></dd>


<dt id="arg-matern-nu">matern_nu<a class="anchor" aria-label="anchor" href="#arg-matern-nu"></a></dt>
<dd><p>The smoothness parameter of the Matern kernel. The default
is 3/2, other possible choices are 5/2 (more smooth) and 1/2 (less smooth).
However, we recommend tuning smoothness primarily using the length scale
priors.</p></dd>


<dt id="arg-boundary-factor">boundary_factor<a class="anchor" aria-label="anchor" href="#arg-boundary-factor"></a></dt>
<dd><p>The boundary factor used in the Gaussian process
approximation. The default (<code>boundary_factor = 3</code>) is higher than the
minimum recommendation from Riutort-Mayol et al. to ensure accurate
real-time estimation. Lower values can lead to boundary effects close to
the present and start of the time series and are thus not recommended. When
modeling very long shedding delays, the boundary factor might need to be
further increased. Note that this will also automatically increase the
number of basis functions used and thereby slow down sampling.</p></dd>


<dt id="arg-n-basis-factor">n_basis_factor<a class="anchor" aria-label="anchor" href="#arg-n-basis-factor"></a></dt>
<dd><p>Factor used to automatically determine <code>m</code>, the number
of basis functions in the Gaussian process approximation. Based on
recommendations from Riutort-Mayol et al., we let <code>m = n_basis_factor * c / (l / S)</code>, where <code>c</code> is the <code>boundary_factor</code>, <code>l</code> is the length scale of
the GP (we use the 5% quantile of <code>gp_length_prior</code> for a conservative
result), and <code>S</code> is the maximum absolute value of the zero-centered input
space, which is <code>(n-1)/2</code> where <code>n</code> is the number of Rt time steps modeled.
This means that the number of basis function automatically adapts to the
length scale and number of observations in the model. For the default
settings (<code>boundary_factor = 3</code> and <code>n_basis_factor = 3.42</code>) and a lower
length scale of 3 weeks, this corresponds to approx. 0.25x the number of Rt
time points modeled. Increasing <code>n_basis_factor</code> will make the
approximation more accurate by proportionally increasing the number of
basis functions, but can slow down sampling.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>Link function. Currently supported are <code>inv_softplus</code> (default)
and <code>scaled_logit</code>. Both of these links are configured to behave
approximately like the identity function around R=1, but become increasingly
non-linear below (and in the case of <code>scaled_logit</code> also above) R=1.</p></dd>


<dt id="arg-r-max">R_max<a class="anchor" aria-label="anchor" href="#arg-r-max"></a></dt>
<dd><p>If <code>link=scaled_logit</code> is used, a maximum reproduction number
must be assumed. This should be higher than any realistic R value for the
modeled pathogen. Default is 6.</p></dd>


<dt id="arg-modeldata">modeldata<a class="anchor" aria-label="anchor" href="#arg-modeldata"></a></dt>
<dd><p>A <code>modeldata</code> object to which the above model specifications
should be added. Default is an empty model given by <code><a href="modeldata_init.html">modeldata_init()</a></code>. Can
also be an already partly specified model returned by other <code>EpiSewer</code>
modeling functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>modeldata</code> object containing data and specifications of the model
to be fitted. Can be passed on to other <code>EpiSewer</code> modeling functions to
add further data and model specifications.</p>
<p>The <code>modeldata</code> object also includes information about parameter
initialization (<code>.init</code>), meta data (<code>.metainfo</code>), and checks to be
performed before model fitting (<code>.checks</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The estimated Rt trajectory is primarily influenced by the priors
for the <em>length scale</em> and the <em>magnitude</em> of the short-term and long-term
Gaussian processes. We recommend adjusting the <em>magnitude</em> when maximum Rt
values seem to be too low or too high. In contrast, we recommend adjusting
the <em>length scale</em> when the Rt trajectory seems to have too little
resolution (try shorter length scales) or is overfitting on noise (try
longer length scales). Note that, to ensure identifiability, the prior mean
for the length scale of the long-term GP should always be significantly
larger than the prior mean for the short-term GP.</p>
<p>The Gaussian process is modeled using a Hilbert space approximation
as described in Riutort-Mayol et al. (2023). This allows for fast inference
without significant loss of accuracy. See the reference for more detail on
choosing an adequate boundary factor and basis function factor. The
<code>EpiSewer</code> implementation of the approximate Gaussian process is strongly
inspired by the implementation in the
<a href="https://github.com/epiforecasts/EpiNow2/" class="external-link">EpiNow2</a> package.</p>
<p>The priors of this component have the following functional form:</p><ul><li><p>R_intercept (intercept):
<code>Normal</code></p></li>
<li><p>magnitude (magnitude):
<code>Truncated Normal</code></p></li>
<li><p>length_scale (length scale):
<code>Truncated Normal</code></p></li>
<li><p>long_magnitude (magnitude for long-term trend):
<code>Truncated Normal</code></p></li>
<li><p>long_length_scale (length scale for long-term trend):
<code>Truncated Normal</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Riutort-Mayol, G., Bürkner, PC., Andersen, M.R. et al. Practical
Hilbert space approximate Bayesian Gaussian processes for probabilistic
programming. <em>Stat Comput</em> 33, 17 (2023).
<a href="https://doi.org/10.1007/s11222-022-10167-2" class="external-link">https://doi.org/10.1007/s11222-022-10167-2</a></p>
<p>Abbott S, Hellewell J, Thompson RN et al. Estimating the
time-varying reproduction number of SARS-CoV-2 using national and
subnational case counts. <em>Wellcome Open Res</em> 5, 112 (2020).
<a href="https://doi.org/10.12688/wellcomeopenres.16006.2" class="external-link">https://doi.org/10.12688/wellcomeopenres.16006.2</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Rt models:
<code><a href="R_estimate_approx.html">R_estimate_approx()</a></code>,
<code><a href="R_estimate_changepoint_splines.html">R_estimate_changepoint_splines()</a></code>,
<code><a href="R_estimate_ets.html">R_estimate_ets()</a></code>,
<code><a href="R_estimate_piecewise.html">R_estimate_piecewise()</a></code>,
<code><a href="R_estimate_rw.html">R_estimate_rw()</a></code>,
<code><a href="R_estimate_smooth_derivative.html">R_estimate_smooth_derivative()</a></code>,
<code><a href="R_estimate_splines.html">R_estimate_splines()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adrian Lison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

